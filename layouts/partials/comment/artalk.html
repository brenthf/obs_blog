<!-- CSS -->
<link href="https://artalk.liuzhenyi.net/dist/Artalk.css" rel="stylesheet">

<!-- JS -->
<script src="https://artalk.liuzhenyi.net/dist/Artalk.js"></script>

<!-- Artalk -->
<div id="Comments"></div>
<script>
Artalk.init({
  el:        '#Comments',                // 绑定元素的 Selector
  pageKey:   '',                  // 固定链接 (留空自动获取)
  pageTitle: '',  // 页面标题 (留空自动获取)
  server:    'https://artalk.liuzhenyi.net',  // 后端地址
  site:      '流光飞舞',             // 你的站点名
})
    ;(function () {
      // @Refer: https://stackoverflow.com/questions/50840168/how-to-detect-if-the-os-is-in-dark-mode-in-browsers
      let darkMode = false

      if (getLS() == "true") {
        darkMode = true;
      } else {
        try {
          if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            darkMode = true;
          }
        } catch {}
      }

      function getLS() {
        return localStorage.getItem("dark_mode_on") || null
      }

      function setLS(val) {
        return localStorage.setItem("dark_mode_on", String(val))
      }

      function checkAndApplyDarkMode () {
        artalk.setDarkMode(darkMode)
        if (darkMode) {
          document.body.classList.add('dark-mode')
        } else {
          document.body.classList.remove('dark-mode')
        }
      }

      checkAndApplyDarkMode()

      const toNightElem = document.querySelector('.to-night')
      toNightElem.addEventListener('click', () => {
        darkMode = !darkMode
        setLS(darkMode)
        checkAndApplyDarkMode()
      })

      // Listen
      try {
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', e => {
          const newColorScheme = e.matches ? "dark" : "light";
          if (newColorScheme == "dark") {
            darkMode = true
          } else {
            darkMode = false
          }

          checkAndApplyDarkMode()
        });
      } catch {}
    })()
</script>
